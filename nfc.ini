<div id="card-wrap" style="display:flex;justify-content:center;margin:16px 0;">
  <div id="flip-card" role="button" aria-pressed="false" tabindex="0" title="카드 뒤집기"
       style="
              width: min(90vw, 360px);
              height: min(90vw, 540px);
              perspective: 1200px;
              ">
    <div id="flip-inner" style="
                                width:100%;height:100%;
                                position:relative;
                                transform-style:preserve-3d;
                                transition: transform 600ms;
                                border-radius: 16px;
                                box-shadow: 0 10px 25px rgba(0,0,0,.15);
                                ">
      <!-- 앞면(이미지 표시) -->
      <div id="card-front" style="
                                  position:absolute;inset:0;
                                  backface-visibility:hidden;
                                  overflow:hidden;border-radius:16px;
                                  ">
        <img id="front-img" alt="front"
             style="width:100%;height:100%;object-fit:cover;display:block;">
      </div>
      <!-- 뒷면(고정 카드 뒷장 이미지) -->
      <div id="card-back" style="
                                 position:absolute;inset:0;
                                 transform: rotateY(180deg);
                                 backface-visibility:hidden;
                                 overflow:hidden;border-radius:16px;
                                 display:flex;align-items:center;justify-content:center;
                                 background:#111;
                                 ">
        <img id="back-img" alt="back"
             style="width:100%;height:100%;object-fit:cover;display:block;opacity:.95;">
      </div>
    </div>
  </div>
</div>
<script>
  /** ---------- 유틸 & 설정 ---------- */
  // (1) 한국시간 YYYY-MM-DD
  function todayKST() {
    const now = new Date();
    // KST 고정: UTC 시간에 +9h
    const kst = new Date(now.getTime() + (9 - now.getTimezoneOffset()/60)*60*60*1000);
    const yyyy = kst.getUTCFullYear();
    const mm = String(kst.getUTCMonth()+1).padStart(2,'0');
    const dd = String(kst.getUTCDate()).padStart(2,'0');
    return `${yyyy}
-${mm}
-${dd}
`;
  }
  // (2) URL 파라미터
  function q(name){
    return new URLSearchParams(location.search).get(name);
  }
  // (3) 32-bit 해시(FNV-1a)
  function hash32(str){
    let h=2166136261>>>0;
    for(let i=0;i<str.length;i++){
      h^=str.charCodeAt(i);
      h=Math.imul(h,16777619);
    }
    return h>>>0;
  }
  /** ---------- 이미지 풀 ---------- */
  // 앞면에 보여줄 이미지 후보들(원하는 대로 교체)
  const IMAGE_POOL = [
    "https://your-cdn.example.com/img/A.jpg",
    "https://your-cdn.example.com/img/B.jpg",
    "https://your-cdn.example.com/img/C.jpg",
    "https://your-cdn.example.com/img/D.jpg"
  ];
  // 뒷면 고정 이미지(카드 뒷장)
  const BACK_IMAGE = "https://your-cdn.example.com/img/card-back.jpg";
  // NFC 코드 + 날짜 기반 '하루 1장 고정' 선택
  const nfc = (q('nfc') || 'default').trim();
  const seed = hash32(`${nfc}
::${todayKST()}
`);
  const todayIndex = IMAGE_POOL.length ? seed % IMAGE_POOL.length : 0;
  let currentIndex = todayIndex;
  // 다음 이미지 고르는 간단 로직(앞면 변경 시 사용)
  function nextIndex(idx){
    if (IMAGE_POOL.length <= 1) return idx;
    // “회전할 때마다” 다른 걸 보고 싶다면 순차 or 해시증분 중 택1
    return (idx + 1) % IMAGE_POOL.length;
    // 순차
    // 또는: return (hash32(`${seed}-${idx}`) % IMAGE_POOL.length);
  }
  /** ---------- 초기 렌더 ---------- */
  const frontImg = document.getElementById('front-img');
  const backImg  = document.getElementById('back-img');
  frontImg.src = IMAGE_POOL[currentIndex] || '';
  backImg.src  = BACK_IMAGE;
  /** ---------- 플립 동작 ---------- */
  const flipCard  = document.getElementById('flip-card');
  const flipInner = document.getElementById('flip-inner');
  let flipped = false;
  let halfwayTimer = null;
  const DURATION = 600;
  // CSS transition과 동일(ms)
  // 접근성: 모션 최소화
  const mql = window.matchMedia('(prefers-reduced-motion: reduce)');
  if (mql.matches) {
    flipInner.style.transition = 'none';
  }
  // 플립 트리거(클릭/탭/키보드)
  function triggerFlip(){
    // 토글
    flipped = !flipped;
    flipCard.setAttribute('aria-pressed', String(flipped));
    flipInner.style.transform = flipped ? 'rotateY(180deg)' : 'rotateY(0deg)';
    // “뒷면이 보이는 순간(180도 근처)”에 앞면 이미지를 교체해서
    // 다시 앞면으로 뒤집을 때 새로운 이미지가 보이도록 설정
    // 반쯤(300ms)에 이미지 교체 -> 매끄럽게 전환
    if (halfwayTimer) clearTimeout(halfwayTimer);
    halfwayTimer = setTimeout(()=>{
      // 뒷면이 보이는 상태일 때 다음 이미지를 준비
      if (flipped) {
        const next = nextIndex(currentIndex);
        if (IMAGE_POOL[next]) {
          frontImg.src = IMAGE_POOL[next];
          currentIndex = next;
        }
      }
    }
                              , Math.max(0, DURATION/2));
  }
  flipCard.addEventListener('click', triggerFlip, {
    passive:true}
                           );
  flipCard.addEventListener('keydown', (e)=>{
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      triggerFlip();
    }
  }
                            , {
    passive:false}
                           );
  // 모바일 탭(터치) 대응: click만으로 충분한 경우가 많지만, 탭 딜레이나 특별한 제스처가 있을 때 대비
  flipCard.addEventListener('touchend', (e)=>{
    e.preventDefault();
    triggerFlip();
  }
                            , {
    passive:false}
                           );
  // 드래그 선택 방지(모바일 이슈 줄이기)
  ['dragstart','selectstart'].forEach(ev=>flipCard.addEventListener(ev, e=>e.preventDefault()));
  /** ---------- 스타일 보조(선택) ---------- */
  // 카드가 로딩되는 동안 깜빡임 줄이기
  frontImg.addEventListener('load', ()=>{
    frontImg.style.opacity = '1';
  }
                           );
  backImg.addEventListener('load',  ()=>{
    backImg .style.opacity = '1';
  }
                          );
</script>
